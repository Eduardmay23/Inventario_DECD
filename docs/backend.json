{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product in the inventory.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "sku": {
          "type": "string",
          "description": "Stock Keeping Unit; a unique identifier for the product, often used internally."
        },
        "category": {
          "type": "string",
          "description": "Category the product belongs to."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "sku",
        "category"
      ]
    },
    "StockLevel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StockLevel",
      "type": "object",
      "description": "Represents the stock level of a product at a specific location.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stock level entry."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N StockLevel)"
        },
        "locationId": {
          "type": "string",
          "description": "Reference to Location. (Relationship: Location 1:N StockLevel)"
        },
        "quantity": {
          "type": "number",
          "description": "Current quantity of the product at the location."
        },
        "lastUpdated": {
          "type": "string",
          "description": "Timestamp of the last stock level update.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productId",
        "locationId",
        "quantity",
        "lastUpdated"
      ]
    },
    "Location": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Location",
      "type": "object",
      "description": "Represents a storage location in the inventory.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the location."
        },
        "name": {
          "type": "string",
          "description": "Name of the location (e.g., Warehouse A, Shelf 2)."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the location."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "StockAlert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StockAlert",
      "type": "object",
      "description": "Represents an alert for low stock levels.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stock alert."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N StockAlert)"
        },
        "locationId": {
          "type": "string",
          "description": "Reference to Location. (Relationship: Location 1:N StockAlert)"
        },
        "threshold": {
          "type": "number",
          "description": "Minimum stock level that triggers the alert."
        },
        "alertDate": {
          "type": "string",
          "description": "Date and time the alert was triggered.",
          "format": "date-time"
        },
        "resolved": {
          "type": "boolean",
          "description": "Boolean indicating if the alert has been resolved. Default value is false."
        }
      },
      "required": [
        "id",
        "productId",
        "locationId",
        "threshold",
        "alertDate",
        "resolved"
      ]
    },
    "StockMovement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StockMovement",
      "type": "object",
      "description": "Represents a movement of stock in the inventory.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stock movement."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N StockMovement)"
        },
        "fromLocationId": {
          "type": "string",
          "description": "Reference to Location. (Relationship: Location 1:N StockMovement).  The location the product moved from."
        },
        "toLocationId": {
          "type": "string",
          "description": "Reference to Location. (Relationship: Location 1:N StockMovement). The location the product moved to."
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product moved."
        },
        "movementDate": {
          "type": "string",
          "description": "Date and time of the stock movement.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "The type of stock movement, for example, restock or relocation.",
          "format": "string"
        }
      },
      "required": [
        "id",
        "productId",
        "fromLocationId",
        "toLocationId",
        "quantity",
        "movementDate",
        "type"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. The {productId} is a unique identifier for each product.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/stockLevels/{stockLevelId}",
        "definition": {
          "entityName": "StockLevel",
          "schema": {
            "$ref": "#/backend/entities/StockLevel"
          },
          "description": "Stores stock level information for a product. Includes denormalized productId for authorization independence. The {stockLevelId} is a unique identifier for each stock level entry.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            },
            {
              "name": "stockLevelId",
              "description": "Unique identifier for the stock level entry."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/stockAlerts/{stockAlertId}",
        "definition": {
          "entityName": "StockAlert",
          "schema": {
            "$ref": "#/backend/entities/StockAlert"
          },
          "description": "Stores stock alerts for a product. Includes denormalized productId for authorization independence. The {stockAlertId} is a unique identifier for each stock alert.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            },
            {
              "name": "stockAlertId",
              "description": "Unique identifier for the stock alert."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/stockMovements/{stockMovementId}",
        "definition": {
          "entityName": "StockMovement",
          "schema": {
            "$ref": "#/backend/entities/StockMovement"
          },
          "description": "Stores stock movement information for a product. Includes denormalized productId for authorization independence. The {stockMovementId} is a unique identifier for each stock movement.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            },
            {
              "name": "stockMovementId",
              "description": "Unique identifier for the stock movement."
            }
          ]
        }
      },
      {
        "path": "/locations/{locationId}",
        "definition": {
          "entityName": "Location",
          "schema": {
            "$ref": "#/backend/entities/Location"
          },
          "description": "Stores location information. The {locationId} is a unique identifier for each location.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the location."
            }
          ]
        }
      },
      {
        "path": "/locations/{locationId}/stockLevels/{stockLevelId}",
        "definition": {
          "entityName": "StockLevel",
          "schema": {
            "$ref": "#/backend/entities/StockLevel"
          },
          "description": "Stores stock level information for a location. Includes denormalized locationId for authorization independence.  The {stockLevelId} is a unique identifier for each stock level entry.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the location."
            },
            {
              "name": "stockLevelId",
              "description": "Unique identifier for the stock level entry."
            }
          ]
        }
      },
      {
        "path": "/locations/{locationId}/stockAlerts/{stockAlertId}",
        "definition": {
          "entityName": "StockAlert",
          "schema": {
            "$ref": "#/backend/entities/StockAlert"
          },
          "description": "Stores stock alerts for a location. Includes denormalized locationId for authorization independence. The {stockAlertId} is a unique identifier for each stock alert.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the location."
            },
            {
              "name": "stockAlertId",
              "description": "Unique identifier for the stock alert."
            }
          ]
        }
      },
      {
        "path": "/locations/{locationId}/stockMovements/{stockMovementId}",
        "definition": {
          "entityName": "StockMovement",
          "schema": {
            "$ref": "#/backend/entities/StockMovement"
          },
          "description": "Stores stock movement information for a location. Includes denormalized locationId for authorization independence. The {stockMovementId} is a unique identifier for each stock movement.",
          "params": [
            {
              "name": "locationId",
              "description": "Unique identifier for the location."
            },
            {
              "name": "stockMovementId",
              "description": "Unique identifier for the stock movement."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure for StockWise is designed to optimize for security, scalability, and query performance, while ensuring clear authorization rules and data integrity.\n\n**Authorization Independence:** Each collection's documents contain all necessary authorization data, eliminating the need for `get()` calls in security rules. This enables atomic operations and simplifies security logic.\n\n**Structural Segregation:** Collections are separated based on their security posture. Each collection houses data with uniform access requirements.\n\n**Access Modeling:** Path-based ownership is utilized for `stockLevels`, `stockAlerts`, and `stockMovements` nested under `products` and `locations`, ensuring a clear ownership hierarchy. \n\n**QAPs Support:** The segregation of data into collections with homogeneous security postures allows for secure list operations.  The path-based ownership model and inclusion of product and location ids in subcollections further allows secure `list` operations while preventing broad access to data.\n\nSpecifically, this design uses path-based ownership for associating `StockLevel`, `StockAlert`, and `StockMovement` with `Product` and `Location`.  This allows for efficient querying and management of data related to a specific product or location, and eliminates the need for complex authorization logic."
  }
}